FUCK. it looks like this bugfix will result in a huge rewrite. original implementation was not according to specs in the first place 